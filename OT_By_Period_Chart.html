<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supervisor OT Hours — By Pay Period</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0f13;
    --surface: #161820;
    --surface2: #1e2028;
    --border: #2a2d38;
    --text: #e8e9f0;
    --muted: #6b6f85;
    --ot1: #4f9cf9;
    --ot1-dim: rgba(79,156,249,0.15);
    --ot2: #38d9a9;
    --ot2-dim: rgba(56,217,169,0.15);
    --net: #f8a94b;
    --net-dim: rgba(248,169,75,0.12);
    --accent: #7c5cfc;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    padding: 40px 32px 60px;
  }

  header {
    margin-bottom: 40px;
  }

  .eyebrow {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 10px;
  }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(26px, 4vw, 42px);
    font-weight: 400;
    color: var(--text);
    line-height: 1.1;
    margin-bottom: 6px;
  }

  h1 em {
    font-style: italic;
    color: var(--net);
  }

  .subtitle {
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.04em;
  }

  /* Legend */
  .legend {
    display: flex;
    gap: 24px;
    margin-bottom: 32px;
    flex-wrap: wrap;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.05em;
  }
  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  /* View toggle */
  .controls {
    display: flex;
    gap: 8px;
    margin-bottom: 28px;
    flex-wrap: wrap;
    align-items: center;
  }
  .view-label {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-right: 4px;
  }
  .btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    padding: 6px 14px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }
  .btn:hover { border-color: var(--accent); color: var(--text); }
  .btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }

  /* Chart wrapper */
  .chart-section { margin-bottom: 20px; }

  /* Stacked bar chart */
  .stacked-chart {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 32px 24px 24px;
  }

  .chart-title {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 24px;
  }

  .bars-container {
    display: flex;
    align-items: flex-end;
    gap: 14px;
    height: 300px;
    position: relative;
    padding-bottom: 50px;
  }

  /* Y-axis grid lines */
  .grid-lines {
    position: absolute;
    top: 0; left: 0; right: 0;
    height: calc(100% - 50px);
    pointer-events: none;
  }
  .grid-line {
    position: absolute;
    left: 0; right: 0;
    border-top: 1px dashed var(--border);
    display: flex;
    align-items: center;
  }
  .grid-label {
    position: absolute;
    right: calc(100% + 8px);
    font-size: 9px;
    color: var(--muted);
    white-space: nowrap;
    transform: translateY(-50%);
  }

  .bar-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    justify-content: flex-end;
    position: relative;
    cursor: pointer;
  }

  .bar-stack {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    border-radius: 4px 4px 0 0;
    overflow: hidden;
    transition: opacity 0.2s, transform 0.2s;
    min-width: 28px;
    max-width: 72px;
    position: relative;
  }

  .bar-group:hover .bar-stack { opacity: 0.95; transform: translateY(-3px); }

  .bar-segment {
    transition: height 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
  }
  .bar-ot1 { background: var(--ot1); }
  .bar-ot2 { background: var(--ot2); }

  .bar-label {
    position: absolute;
    bottom: -46px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 9px;
    color: var(--muted);
    text-align: center;
    white-space: nowrap;
    line-height: 1.3;
    width: 72px;
  }

  .bar-total {
    position: absolute;
    top: -22px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    font-weight: 500;
    color: var(--net);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .bar-group:hover .bar-total { opacity: 1; }

  /* Tooltip */
  .tooltip {
    position: fixed;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 16px;
    font-size: 11px;
    pointer-events: none;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.15s;
    min-width: 180px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .tooltip.visible { opacity: 1; }
  .tt-period { font-size: 10px; color: var(--accent); letter-spacing: 0.08em; margin-bottom: 8px; text-transform: uppercase; }
  .tt-row { display: flex; justify-content: space-between; gap: 16px; margin-bottom: 4px; color: var(--muted); }
  .tt-row span:last-child { color: var(--text); font-weight: 500; }
  .tt-divider { border-top: 1px solid var(--border); margin: 6px 0; }
  .tt-net { display: flex; justify-content: space-between; gap: 16px; color: var(--net); font-weight: 500; }

  /* Per-supervisor view */
  .sup-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
  }

  .sup-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    transition: border-color 0.2s, transform 0.2s;
  }
  .sup-card:hover { border-color: var(--accent); transform: translateY(-2px); }

  .sup-name {
    font-family: 'DM Serif Display', serif;
    font-size: 15px;
    color: var(--text);
    margin-bottom: 4px;
  }
  .sup-total {
    font-size: 10px;
    color: var(--muted);
    margin-bottom: 16px;
    letter-spacing: 0.05em;
  }
  .sup-total strong { color: var(--net); }

  .period-bars {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .period-row {
    display: grid;
    grid-template-columns: 90px 1fr 46px;
    align-items: center;
    gap: 8px;
  }

  .period-name {
    font-size: 9px;
    color: var(--muted);
    text-align: right;
    letter-spacing: 0.03em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .period-bar-track {
    height: 16px;
    background: var(--surface2);
    border-radius: 3px;
    overflow: hidden;
    display: flex;
  }
  .period-bar-ot1 {
    height: 100%;
    background: var(--ot1);
    border-radius: 3px 0 0 3px;
    transition: width 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .period-bar-ot2 {
    height: 100%;
    background: var(--ot2);
    transition: width 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-radius: 0;
  }
  .period-net {
    font-size: 9px;
    color: var(--net);
    text-align: right;
    font-weight: 500;
  }

  /* Heatmap view */
  .heatmap-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 28px 24px;
    overflow-x: auto;
  }

  .heatmap-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 3px;
  }

  .hm-th {
    font-size: 9px;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 8px;
    text-align: center;
    white-space: nowrap;
  }
  .hm-th-name {
    text-align: left;
    padding-left: 0;
    min-width: 130px;
  }

  .hm-td {
    border-radius: 4px;
    padding: 10px 6px;
    text-align: center;
    font-size: 11px;
    font-weight: 500;
    transition: transform 0.15s;
    cursor: default;
    min-width: 60px;
  }
  .hm-td:hover { transform: scale(1.08); z-index: 1; position: relative; }
  .hm-name {
    font-size: 11px;
    color: var(--text);
    padding: 8px 4px;
    white-space: nowrap;
  }

  /* Summary stats row */
  .stats-row {
    display: flex;
    gap: 16px;
    margin-bottom: 32px;
    flex-wrap: wrap;
  }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px 20px;
    flex: 1;
    min-width: 160px;
  }
  .stat-label { font-size: 9px; color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 6px; }
  .stat-val { font-family: 'DM Serif Display', serif; font-size: 28px; line-height: 1; }
  .stat-val.blue { color: var(--ot1); }
  .stat-val.green { color: var(--ot2); }
  .stat-val.amber { color: var(--net); }

  .view-stacked { display: block; }
  .view-supervisor { display: none; }
  .view-heatmap { display: none; }
</style>
</head>
<body>

<header>
  <div class="eyebrow">Timesheet Analysis · Jul 2025 – Feb 2026</div>
  <h1>Supervisor <em>Overtime</em> Hours</h1>
  <p class="subtitle">OT1 &amp; OT2 hours · 7 pay periods</p>
</header>

<div class="stats-row" id="statsRow"></div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:var(--ot1)"></div> OT1</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--ot2)"></div> OT2</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--net)"></div> Net Total OT</div>
</div>

<div class="controls">
  <span class="view-label">View</span>
  <button class="btn active" onclick="setView('stacked')">Stacked Bar</button>
  <button class="btn" onclick="setView('supervisor')">By Supervisor</button>
  <button class="btn" onclick="setView('heatmap')">Heatmap</button>
</div>

<div class="chart-section">
  <div class="view-stacked" id="viewStacked">
    <div class="stacked-chart">
      <div class="chart-title">Net OT Hours per Pay Period (OT1 + OT2)</div>
      <div class="bars-container" id="mainChart"></div>
    </div>
  </div>

  <div class="view-supervisor" id="viewSupervisor">
    <div class="sup-grid" id="supGrid"></div>
  </div>

  <div class="view-heatmap" id="viewHeatmap">
    <div class="heatmap-wrap">
      <div class="chart-title">Net Total OT per Supervisor × Pay Period</div>
      <table class="heatmap-table" id="hmTable"></table>
    </div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
const PERIODS = [
  "21 Jul–17 Aug '25",
  "18 Aug–14 Sep '25",
  "15 Sep–12 Oct '25",
  "13 Oct–09 Nov '25",
  "10 Nov–07 Dec '25",
  "08 Dec '25–04 Jan '26",
  "05 Jan–01 Feb '26",
];

const PERIODS_FULL = [
  "21 Jul – 17 Aug 2025",
  "18 Aug – 14 Sep 2025",
  "15 Sep – 12 Oct 2025",
  "13 Oct – 09 Nov 2025",
  "10 Nov – 07 Dec 2025",
  "08 Dec 2025 – 04 Jan 2026",
  "05 Jan – 01 Feb 2026",
];

// [ot1_raw, ot2_raw, ph] per period per supervisor
const RAW = {
  'Anthony Bowles':   [null, null, null, null, null, [3,1.25,9.5], null],
  'Deb Robin':        [[1,0,0], null, [3,53.5,0], [3,37,0], null, null, null],
  'Doug Lamont':      [[3,1,0], [3,24,0], [3,24,0], [3,96.5,0], [3,65.5,0], [3,0.5,0], null],
  'Freya Morton':     [[3,6.5,0], null, [3,29,0], [3,37,0], [3,20,0], [3,17,19], null],
  'Jonathan Reutens': [null, [3,8.5,0], null, [0,0,9.5], [3,61,0], null, [3,8.2,0]],
  'Jordan Santella':  [[3,6.5,0], null, [3,21.5,0], [3,49.5,9], [3,29.5,0], [3,15,0], null],
  'Kyle Powell':      [null, [3,21.5,0], [3,29.5,0], [3,32,0], [3,45.5,0], [3,18,19], null],
  'Patrick Chan':     [null, [3,6,0], [3,23.5,0], [3,16,0], [3,46.5,0], [3,40,9.5], null],
  'Sandra Trajkoska': [null, null, null, null, null, [3,6.5,9.5], [3,6.5,0]],
  'Tia Powell':       [null, [3,19,0], [3,50.5,0], [3,80.5,0], [3,19.5,0], [3,20,19], null],
};

function adjCalc(ot1, ot2, ph) {
  const a1 = Math.max(0, ot1 - ph);
  const rem = Math.max(0, ph - ot1);
  const a2 = Math.max(0, ot2 - rem);
  return [a1, a2];
}

// Build computed data
const SUPERVISORS = Object.keys(RAW);
const DATA = {}; // supervisor -> [{a1, a2, net}] per period

SUPERVISORS.forEach(s => {
  DATA[s] = RAW[s].map(r => {
    if (!r) return {a1:0, a2:0, net:0};
    const [a1, a2] = adjCalc(r[0], r[1], r[2]);
    return {a1, a2, net: a1+a2};
  });
});

// Period totals
const PERIOD_TOTALS = PERIODS.map((_, pi) => {
  let a1=0, a2=0;
  SUPERVISORS.forEach(s => { a1+=DATA[s][pi].a1; a2+=DATA[s][pi].a2; });
  return {a1, a2, net: a1+a2};
});

// Grand totals
const GRAND = SUPERVISORS.reduce((acc, s) => {
  DATA[s].forEach(d => { acc.a1+=d.a1; acc.a2+=d.a2; acc.net+=d.net; });
  return acc;
}, {a1:0, a2:0, net:0});

// ── Stats Row ──
function buildStats() {
  const container = document.getElementById('statsRow');
  const maxPeriod = PERIOD_TOTALS.reduce((m, p, i) => p.net > m.val ? {val:p.net, idx:i} : m, {val:0,idx:0});

  const stats = [
    {label:'Total OT Hours', val: GRAND.net.toFixed(1), cls:'amber'},
    {label:'Total OT1', val: GRAND.a1.toFixed(1), cls:'blue'},
    {label:'Total OT2', val: GRAND.a2.toFixed(1), cls:'green'},
    {label:'Peak Period Net OT', val: maxPeriod.val.toFixed(1), cls:'amber', sub: PERIODS[maxPeriod.idx]},
  ];
  container.innerHTML = stats.map(s => `
    <div class="stat-card">
      <div class="stat-label">${s.label}</div>
      <div class="stat-val ${s.cls}">${s.val}</div>
      ${s.sub ? `<div style="font-size:9px;color:var(--muted);margin-top:4px">${s.sub}</div>` : ''}
    </div>
  `).join('');
}

// ── Stacked Bar Chart ──
function buildStackedChart() {
  const container = document.getElementById('mainChart');
  const maxVal = Math.max(...PERIOD_TOTALS.map(p => p.net));
  const chartH = 250; // usable height in px

  // Grid lines
  const gridVals = [0, 100, 200, 300, 400].filter(v => v <= Math.ceil(maxVal/100)*100);
  let gridHTML = `<div class="grid-lines">`;
  gridVals.forEach(v => {
    const pct = 100 - (v / (Math.ceil(maxVal/50)*50)) * 100;
    gridHTML += `<div class="grid-line" style="top:${pct}%">
      <span class="grid-label">${v}</span>
    </div>`;
  });
  gridHTML += `</div>`;
  container.innerHTML = gridHTML;

  const maxScale = Math.ceil(maxVal / 50) * 50;

  PERIOD_TOTALS.forEach((pt, pi) => {
    const ot1H = (pt.a1 / maxScale) * chartH;
    const ot2H = (pt.a2 / maxScale) * chartH;
    const totalH = ot1H + ot2H;

    const group = document.createElement('div');
    group.className = 'bar-group';
    group.innerHTML = `
      <div class="bar-total">${pt.net.toFixed(1)}h</div>
      <div class="bar-stack" style="height:${totalH}px">
        <div class="bar-segment bar-ot2" style="height:${ot2H}px"></div>
        <div class="bar-segment bar-ot1" style="height:${ot1H}px"></div>
      </div>
      <div class="bar-label">${PERIODS[pi].replace("'", "'")}</div>
    `;

    // Tooltip
    group.addEventListener('mousemove', (e) => {
      const tt = document.getElementById('tooltip');
      // Build supervisor breakdown for this period
      let rows = SUPERVISORS
        .filter(s => DATA[s][pi].net > 0)
        .sort((a,b) => DATA[b][pi].net - DATA[a][pi].net)
        .map(s => `<div class="tt-row"><span>${s}</span><span>${DATA[s][pi].net.toFixed(1)}h</span></div>`)
        .join('');
      
      tt.innerHTML = `
        <div class="tt-period">${PERIODS_FULL[pi]}</div>
        <div class="tt-row"><span>OT1</span><span style="color:var(--ot1)">${pt.a1.toFixed(1)}h</span></div>
        <div class="tt-row"><span>OT2</span><span style="color:var(--ot2)">${pt.a2.toFixed(1)}h</span></div>
        <div class="tt-divider"></div>
        ${rows}
        <div class="tt-divider"></div>
        <div class="tt-net"><span>Net Total</span><span>${pt.net.toFixed(1)}h</span></div>
      `;
      tt.classList.add('visible');
      tt.style.left = (e.clientX + 16) + 'px';
      tt.style.top = (e.clientY - 60) + 'px';
    });
    group.addEventListener('mouseleave', () => {
      document.getElementById('tooltip').classList.remove('visible');
    });

    container.appendChild(group);
  });
}

// ── Supervisor Cards ──
function buildSupCards() {
  const grid = document.getElementById('supGrid');
  const maxNet = Math.max(...SUPERVISORS.flatMap(s => DATA[s].map(d => d.net)));

  grid.innerHTML = SUPERVISORS.map(s => {
    const total = DATA[s].reduce((a,d)=>a+d.net,0);
    const a1t = DATA[s].reduce((a,d)=>a+d.a1,0);
    const a2t = DATA[s].reduce((a,d)=>a+d.a2,0);
    if (total === 0) return '';

    const periodRows = DATA[s].map((d, pi) => {
      if (d.net === 0) return '';
      const w1 = (d.a1 / maxNet) * 100;
      const w2 = (d.a2 / maxNet) * 100;
      const shortP = PERIODS[pi].split('–')[0].trim();
      return `
        <div class="period-row">
          <div class="period-name">${PERIODS[pi]}</div>
          <div class="period-bar-track">
            <div class="period-bar-ot1" style="width:${w1}%"></div>
            <div class="period-bar-ot2" style="width:${w2}%"></div>
          </div>
          <div class="period-net">${d.net.toFixed(1)}h</div>
        </div>
      `;
    }).join('');

    return `
      <div class="sup-card">
        <div class="sup-name">${s}</div>
        <div class="sup-total">Total: <strong>${total.toFixed(1)}h</strong> &nbsp;·&nbsp; OT1: <span style="color:var(--ot1)">${a1t.toFixed(1)}h</span> &nbsp;·&nbsp; OT2: <span style="color:var(--ot2)">${a2t.toFixed(1)}h</span></div>        <div class="period-bars">${periodRows}</div>
      </div>
    `;
  }).join('');
}

// ── Heatmap ──
function buildHeatmap() {
  const table = document.getElementById('hmTable');
  const allNets = SUPERVISORS.flatMap(s => DATA[s].map(d => d.net)).filter(v => v > 0);
  const maxNet = Math.max(...allNets);

  function heatColor(val) {
    if (val === 0) return '#1e2028';
    const t = val / maxNet;
    // dark teal -> amber -> bright amber
    if (t < 0.33) {
      const r = Math.round(30 + t/0.33 * (56-30));
      const g = Math.round(32 + t/0.33 * (140-32));
      const b = Math.round(40 + t/0.33 * (100-40));
      return `rgb(${r},${g},${b})`;
    } else if (t < 0.66) {
      const tt = (t-0.33)/0.33;
      const r = Math.round(56 + tt*(248-56));
      const g = Math.round(140 + tt*(169-140));
      const b = Math.round(100 + tt*(75-100));
      return `rgb(${r},${g},${b})`;
    } else {
      const tt = (t-0.66)/0.34;
      const r = Math.round(248 + tt*(255-248));
      const g = Math.round(169 + tt*(220-169));
      const b = Math.round(75 + tt*(80-75));
      return `rgb(${r},${g},${b})`;
    }
  }

  function textColor(val) {
    if (val === 0) return '#3a3d4a';
    const t = val / maxNet;
    return t > 0.3 ? '#0e0f13' : '#e8e9f0';
  }

  let html = `<thead><tr>
    <th class="hm-th hm-th-name">Supervisor</th>
    ${PERIODS.map(p => `<th class="hm-th">${p}</th>`).join('')}
    <th class="hm-th">Total</th>
  </tr></thead><tbody>`;

  SUPERVISORS.forEach(s => {
    const total = DATA[s].reduce((a,d)=>a+d.net, 0);
    if (total === 0) return;
    html += `<tr>
      <td class="hm-name">${s}</td>
      ${DATA[s].map(d => `
        <td class="hm-td" style="background:${heatColor(d.net)};color:${textColor(d.net)}">
          ${d.net > 0 ? d.net.toFixed(1) : ''}
        </td>
      `).join('')}
      <td class="hm-td" style="background:${heatColor(total)};color:${textColor(total)};font-size:12px">
        ${total.toFixed(1)}
      </td>
    </tr>`;
  });

  // Period totals row
  html += `<tr style="border-top:1px solid #2a2d38">
    <td class="hm-name" style="color:var(--muted);font-size:10px">Period Total</td>
    ${PERIOD_TOTALS.map(pt => `
      <td class="hm-td" style="background:${heatColor(pt.net)};color:${textColor(pt.net)};font-size:11px;font-weight:700">
        ${pt.net.toFixed(1)}
      </td>
    `).join('')}
    <td class="hm-td" style="background:${heatColor(GRAND.net)};color:${textColor(GRAND.net)};font-size:12px;font-weight:700">
      ${GRAND.net.toFixed(1)}
    </td>
  </tr>`;

  html += '</tbody>';
  table.innerHTML = html;
}

function setView(v) {
  document.querySelectorAll('.view-stacked, .view-supervisor, .view-heatmap').forEach(el => el.style.display = 'none');
  document.querySelector('.view-' + v).style.display = 'block';
  document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

// Init
buildStats();
buildStackedChart();
buildSupCards();
buildHeatmap();
</script>
</body>
</html>
